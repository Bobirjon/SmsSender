<div>
    <form [formGroup]="massPowerForm" class="form-container">
        <mat-grid-list cols="20" rowHeight="85px">
            <mat-grid-tile colspan="2">
                <!-- level -->
                <mat-form-field class="margin-container">
                    <mat-label>Уровень</mat-label>
                    <mat-select formControlName="level">
                        <mat-option *ngFor="let lev of level" [value]="lev.value">
                            {{lev.viewValue}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </mat-grid-tile>
            <!-- region -->
            <mat-grid-tile colspan="4">
                <mat-form-field class="margin-container">
                    <mat-label>Регион</mat-label>
                    <mat-select formControlName="region">
                        <mat-option *ngFor="let reg of region" [value]="reg.value">
                            {{reg.value}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </mat-grid-tile>
            <!-- informed -->
            <mat-grid-tile colspan="4" rowspan="1">
                <mat-form-field class="margin-container">
                    <mat-label>Оповещен</mat-label>
                    <input matInput type="text" formControlName="informed" />
                </mat-form-field>
            </mat-grid-tile>
            <!-- preview resheniya-->
            <mat-grid-tile colspan="5" rowspan="5">
                <div class="grid-container">
                    <mat-card class="preview">
                        <mat-card-header>
                            <mat-card-title>
                                {{massPowerForm.value.level.replace('P', 'П') + ' Решение: '}}
                            </mat-card-title>
                            <mat-card-title
                                *ngIf="massPowerForm.value.AddOrCor == 'Дополнение'">(Дополнения)</mat-card-title>
                            <mat-card-title
                                *ngIf="massPowerForm.value.AddOrCor == 'Коррекция'">(Коррекция)</mat-card-title>
                        </mat-card-header>
                        <mat-card-content>
                            <p>{{massPowerForm.value.problem}}</p>
                            <p>{{'Эффект: ' + massPowerForm.value.effect}} </p>
                            <p>{{'Причина: ' + massPowerForm.value.reason}} </p>
                            <p>{{'Описание: ' + massPowerForm.value.desc}} </p>
                            <p>{{'Начало: ' + massPowerForm.value.startTime.replace("T", " ")}}</p>
                            <p>{{'Окончание: ' + massPowerForm.value.endTime.replace("T", " ")}}</p>
                            <p>{{'Информирован: ' + massPowerForm.value.informed}} </p>
                            <p>{{'Отправил: ' + this.user?.first_name + ' ' + this.user?.last_name}}</p>
                        </mat-card-content>
                        <mat-card-actions>
                            <button class="form-button" mat-raised-button color="primary"
                                (click)="onSubmitButtonProblem('Решение')" type="submit"
                                *ngIf="asNew == false"
                                [disabled]="massPowerForm.invalid || massPowerForm.value.endTime !==''">
                                Отправить Сообщения
                            </button>
                            <button class="form-button" mat-raised-button color="primary"
                                (click)="onSubmitasNew('Решение')" type="submit"
                                *ngIf="asNew == true && newForm == false"
                                [disabled]="(massPowerForm.invalid) || massPowerForm.value.endTime !==''">
                                Новое SMS
                            </button>
                            <button class="form-button" mat-raised-button color="primary"
                                (click)="forSmsTesting('Решение')" type="submit"
                                [disabled]="massPowerForm.invalid || massPowerForm.value.endTime !==''">
                                TEST SMS
                            </button>
                        </mat-card-actions>
                    </mat-card>
                </div>
            </mat-grid-tile>
            <!-- preview informirovan-->
            <mat-grid-tile colspan="5" rowspan="5">
                <div class="grid-container">
                    <mat-card class="preview">
                        <mat-card-header>
                            <mat-card-title>
                                {{massPowerForm.value.level.replace('P', 'П') + ' Информационное: '}}
                            </mat-card-title>
                            <mat-card-title
                                *ngIf="massPowerForm.value.AddOrCor == 'Дополнение'">(Дополнения)</mat-card-title>
                            <mat-card-title
                                *ngIf="massPowerForm.value.AddOrCor == 'Коррекция'">(Коррекция)</mat-card-title>
                        </mat-card-header>
                        <mat-card-content>
                            <p>{{massPowerForm.value.problem}}</p>
                            <p>{{'Эффект: ' + massPowerForm.value.effect}} </p>
                            <p>{{'Причина: ' + massPowerForm.value.reason}} </p>
                            <p>{{'Описание: ' + massPowerForm.value.desc}} </p>
                            <p>{{'Начало: ' + massPowerForm.value.startTime.replace("T", " ")}}</p>
                            <p>{{'Окончание: ' + massPowerForm.value.endTime.replace("T", " ")}}</p>
                            <p>{{'Информирован: ' + massPowerForm.value.informed}} </p>
                            <p>{{'Отправил: ' + this.user?.first_name + ' ' + this.user?.last_name}}</p>
                        </mat-card-content>
                        <mat-card-actions>
                            <button class="form-button" mat-raised-button color="primary"
                                (click)="onSubmitButtonProblem('Информационное')" type="submit"
                                *ngIf="asNew == false"
                                [disabled]="massPowerForm.invalid || massPowerForm.value.endTime !==''">
                                Отправить Сообщения
                            </button>
                            <button class="form-button" mat-raised-button color="primary"
                                (click)="onSubmitasNew('Информационное')" type="submit"
                                *ngIf="asNew == true && newForm == false"
                                [disabled]="(massPowerForm.invalid) || massPowerForm.value.endTime !==''">
                                Новое SMS
                            </button>
                            <button class="form-button" mat-raised-button color="primary"
                                (click)="forSmsTesting('Информационное')" type="submit"
                                [disabled]="massPowerForm.invalid || massPowerForm.value.endTime !==''">
                                TEST SMS
                            </button>
                        </mat-card-actions>
                    </mat-card>
                </div>
            </mat-grid-tile>

            <!-- problem -->
            <mat-grid-tile colspan="5">
                <mat-form-field class="margin-container">
                    <mat-label>Проблема</mat-label>
                    <textarea matInput type="text" formControlName="problem" spellcheck="true"> </textarea>
                </mat-form-field>
            </mat-grid-tile>
            <!-- reason -->
            <mat-grid-tile colspan="5">
                <mat-form-field class="margin-container">
                    <mat-label>Причина</mat-label>
                    <textarea matInput type="text" formControlName="reason" spellcheck="true">
                    </textarea>
                </mat-form-field>
            </mat-grid-tile>

            <!-- Description -->
            <mat-grid-tile colspan="5" rowspan="1">
                <mat-form-field class="margin-container">
                    <mat-label>Описание</mat-label>
                    <textarea matInput type="text" formControlName="desc" spellcheck="true"></textarea>
                </mat-form-field>
            </mat-grid-tile>
            <!-- effect -->
            <mat-grid-tile colspan="5" rowspan="1">
                <mat-form-field class="margin-container">
                    <mat-label>Эффект</mat-label>
                    <textarea matInput type="text" formControlName="effect" spellcheck="true">
                </textarea>
                </mat-form-field>
            </mat-grid-tile>
            <!-- start Time -->
            <mat-grid-tile colspan="5">
                <div class="margin-container">
                    <p>Начало</p>
                    <input type="datetime-local" class="dateTime" name="startTime" formControlName="startTime"
                        min="2023-01-01T00:00" [max]="time | date: 'yyyy-MM-ddTHH:mm'">
                </div>
            </mat-grid-tile>
            <!-- end Time -->
            <mat-grid-tile colspan="5">
                <div class="margin-container">
                    <p>Конец<span
                            *ngIf="massPowerForm.get('endTime').hasError('timeValid') && massPowerForm.get('startTime').touched"
                            class="timeNotValid"> *Начало больше чем Конец времени</span></p>
                    <input type="datetime-local" class="dateTime" formControlName="endTime"
                       >
                </div>
            </mat-grid-tile>
            <!-- buttons -->
            <mat-grid-tile colspan="2" style="margin-left: 25px;">
                <button class="form-button" mat-raised-button type="button" *ngIf="newForm == false"
                    (click)="updateData()" style="position: absolute; bottom: 8px;">Обновить</button>
                <button class="form-button" mat-raised-button type="button" *ngIf="newForm == true"
                    [disabled]="massPowerForm.invalid" (click)="createData()"
                    style="position: absolute; bottom: 0px;">Создать</button>
            </mat-grid-tile>
            <mat-grid-tile colspan="1">

            </mat-grid-tile>
            <mat-grid-tile colspan="4">
                <mat-chip-listbox formControlName="AddOrCor" style="position: absolute; bottom: 8px;">
                    <mat-chip-option value="Коррекция">Коррекция</mat-chip-option>
                    <mat-chip-option value="Дополнения">Дополнение</mat-chip-option>
                </mat-chip-listbox>
            </mat-grid-tile>
        </mat-grid-list>
    </form>
</div>