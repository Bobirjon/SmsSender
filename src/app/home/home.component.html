<div class="container" *ngIf="Loaded == true">
  <mat-grid-list cols="10" rowHeight="100px">
    <mat-grid-tile colspan="6">
      <button mat-raised-button color="primary" (click)="onCN()">Создать CN шаблон</button>
      <button mat-raised-button color="primary" (click)="onRN()" style="margin-left: 15px;">Создать RN шаблон</button>
      <button mat-raised-button color="primary" (click)="addNumber()" style="margin-left: 15px;"
        *ngIf="isAdmin == 'admin'">Добавить получателя</button>
      <button mat-raised-button color="primary" (click)="exportXlsx()" style="margin-left: 15px;"> Экспорт таблицы
      </button>
    </mat-grid-tile>
  </mat-grid-list>
  <mat-divider></mat-divider>


  <h1 style="margin-left: 50px; margin-top: 40px;">Открытые Инциденты</h1>

  <!-- <mat-form-field style="margin-left: 20px;">
    <mat-label>Поиск по открытым инцидентам</mat-label>
    <input matInput type="text" (keyup)="applyFilter($event)" #input>
  </mat-form-field>

  <mat-form-field style="margin-left: 50px;" appearance="fill" *ngFor="let selectableFilter of selectableFilters">
    <mat-label>{{ selectableFilter.name }}</mat-label>
    <mat-select [(value)]="selectableFilter.defaultValue"
      (selectionChange)="applySelectableFilter($event, selectableFilter)">
      <mat-option *ngFor="let op of selectableFilter.options" [value]="op">
        {{ op.replace('P','П') }}
      </mat-option>
    </mat-select>
  </mat-form-field> -->

  <mat-form-field>
    <mat-label>Поиск по открытым инцидентам</mat-label>
    <input matInput (input)="applyFilterInput()" #input [(ngModel)]="inputFilterValue">
  </mat-form-field>

  <mat-form-field>
    <mat-label>Уровень</mat-label>
    <mat-select (selectionChange)="applyFilterSelect1($event.value)" [(ngModel)]="selectFilterValue1">
      <mat-option value="A1">A1</mat-option>
      <mat-option value="A2">A2</mat-option>
      <mat-option value="A3">A3</mat-option>
      <mat-option value="A4">A4</mat-option>
      <mat-option value="A5">A5</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field>
    <mat-label>Уровень</mat-label>
    <mat-select (selectionChange)="applyFilterSelect2($event.value)">
      <mat-option value="CORE">CORE</mat-option>
      <mat-option value="CHRONIC">CHRONIC</mat-option>
      <mat-option value="BSC">BSC</mat-option>
      <mat-option value="HUB">HUB</mat-option>
    </mat-select>
  </mat-form-field>

  <div class="table-style">
    <table mat-table [dataSource]="Data" matSort #table1 #table1sort="matSort" class="mat-elevation-z8 full-width-table" id="open-case">

      <ng-container matColumnDef="level">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Уровень</th>
        <td mat-cell *matCellDef="let row">{{row.level.replace('P','П')}}</td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Тип</th>
        <td mat-cell *matCellDef="let row">{{row.type}}</td>
      </ng-container>

      <ng-container matColumnDef="created_at">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата Создания</th>
        <td mat-cell *matCellDef="let element">{{element.created_at.replace('T', ' ').substring('0','16')}}</td>
      </ng-container>

      <ng-container matColumnDef="start_time">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата Начало</th>
        <td mat-cell *matCellDef="let element">{{element.start_time.replace('T', ' ').substring('0','16')}}</td>
      </ng-container>

      <ng-container matColumnDef="problem">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Проблема</th>
        <td mat-cell *matCellDef="let row">{{row.problem}}</td>
      </ng-container>

      <ng-container matColumnDef="reason">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Причина</th>
        <td mat-cell *matCellDef="let row">{{row.reason}}</td>
      </ng-container>

      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Описания</th>
        <td mat-cell *matCellDef="let row">{{row.description}}</td>
      </ng-container>

      <ng-container matColumnDef="region">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Регион</th>
        <td mat-cell *matCellDef="let element">{{element.region}} </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Действия</th>
        <td mat-cell *matCellDef="let element">
            <a routerLink="/home/{{element.type}}/{{element.id}}" (click)="onEdit()" style="color: black;">
              <mat-icon aria-hidden="false" fontIcon="edit" style="margin-right: 10px;"></mat-icon>
            </a>
            <button style="background-color: transparent; border: none; cursor: pointer;" (click)="onDelete(element.id)">
              <mat-icon aria-hidden="false" fontIcon="delete"></mat-icon>
            </button>
            
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumnsNew"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsNew" 
      [ngClass]="((row.chronic_hours >= '48') ? 'chronicHours' : 'fail')"></tr>
    </table>

    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
    </tr>
  </div>
  <hr>

  <h1 style="margin-left: 50px; margin-top: 40px;">Все Инциденты</h1>

  <div class="table-style"> 
    <table mat-table [dataSource]="dataTable" matSort  matSortActive="created_at" matSortDisableClear matSortDirection="desc" #table2 #table2sort="matSort" class="mat-elevation-z8 full-width-table">

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Тип</th>
        <td mat-cell *matCellDef="let row">{{row.type}}</td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="type" search
            [formControl]="type"></td>
      </ng-container>

      <ng-container matColumnDef="level">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Уровень</th>
        <td mat-cell *matCellDef="let row">{{row.level.replace('P','П')}}</td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="level" search
            [formControl]="level"></td>
      </ng-container>

      <ng-container matColumnDef="created_at">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата Создания</th>
        <td mat-cell *matCellDef="let element">{{element.created_at.replace('T', ' ').substring('0','16')}}</td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="created_at" search
            [formControl]="createdAt"></td>
      </ng-container>

      <ng-container matColumnDef="start_time">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата Начало</th>
        <td mat-cell *matCellDef="let element">{{element.start_time.replace('T', ' ').substring('0','16')}}</td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="start_time" search
            [formControl]="startTime"></td>
      </ng-container>

      <ng-container matColumnDef="end_time">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата Окончания</th>
        <td mat-cell *matCellDef="let element">{{element.end_time?.replace('T', ' ').substring('0','16')}}</td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="end_time" search
            [formControl]="endTime"></td>
      </ng-container>

      <ng-container matColumnDef="problem">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Проблема</th>
        <td mat-cell *matCellDef="let row">{{row.problem}}</td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="problem" search
            [formControl]="problem"></td>
      </ng-container>

      <ng-container matColumnDef="reason">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Причина</th>
        <td mat-cell *matCellDef="let row">{{row?.reason}}</td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="reason" search
            [formControl]="reason"></td>
      </ng-container>

      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Описания</th>
        <td mat-cell *matCellDef="let row">{{row.description}}</td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="description" search
            [formControl]="description"></td>
      </ng-container>

      <ng-container matColumnDef="region">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Регион</th>
        <td mat-cell *matCellDef="let element">{{element.region}} </td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="problem" search
            [formControl]="region"></td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Действия</th>
        <td mat-cell *matCellDef="let element">

          <a routerLink="/home/{{element.type}}/{{element.id}}" (click)="onEdit()" style="color: black;cursor: pointer;">
            <mat-icon aria-hidden="false" fontIcon="edit" style="margin-right: 10px;"></mat-icon>
          </a>
          <button style="background-color: transparent; border: none; cursor: pointer;" (click)="onDelete(element.id)">
            <mat-icon aria-hidden="false" fontIcon="delete"></mat-icon>
          </button>

        </td>
        <td mat-footer-cell *matFooterCellDef><input class="filter" matInput placeholder="problem" search
            [formControl]="username"></td>
      </ng-container>


      <tr mat-header-row *matHeaderRowDef="displayedColumnsForAllCases"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsForAllCases"
        [ngClass]="((row.reason.includes('Выясняется')) ? 'reason' : 'fail')">
      </tr>
 
      <tr mat-footer-row *matFooterRowDef="displayedColumnsForAllCases" class="example-first-footer-row"></tr>

      <tr *matNoDataRow>
        <td class="mat-cell" colspan="4">The filter does not match any item in the data for this text</td>
      </tr>
    </table>

    <!-- <mat-paginator [pageSizeOptions]="[10,20,30,40,50]" aria-labels="select page"></mat-paginator> -->
    <mat-paginator #paginator [pageSizeOptions]="pageSizes" [length]="resultsLength" showFirstLastButtons></mat-paginator>
  </div>

</div>
<router-outlet></router-outlet>